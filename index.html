<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Basketball Q4 Predictor</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, sans-serif;
            background: linear-gradient(135deg, #1a1a2e 0%, #16213e 100%);
            color: #e0e0e0;
            min-height: 100vh;
            padding: 20px;
        }

        .container {
            max-width: 600px;
            margin: 0 auto;
        }

        h1 {
            text-align: center;
            margin-bottom: 30px;
            font-size: 24px;
            color: #ff6b35;
            text-transform: uppercase;
            letter-spacing: 2px;
        }

        .view-toggle {
            display: flex;
            gap: 10px;
            margin-bottom: 30px;
        }

        .view-toggle button {
            flex: 1;
            padding: 12px;
            border: none;
            background: #2a2a3e;
            color: #e0e0e0;
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.3s;
            font-size: 14px;
            font-weight: 600;
        }

        .view-toggle button.active {
            background: #ff6b35;
            color: #1a1a2e;
        }

        .page {
            display: none;
        }

        .page.active {
            display: block;
        }

        .game-table {
            background: #2a2a3e;
            border-radius: 12px;
            padding: 20px;
            overflow-x: auto;
        }

        table {
            width: 100%;
            border-collapse: collapse;
        }

        th {
            padding: 12px 8px;
            text-align: center;
            font-size: 12px;
            color: #a0a0a0;
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: 1px;
            border-bottom: 2px solid #3a3a4e;
        }

        td {
            padding: 15px 8px;
            text-align: center;
        }

        .team-name-cell {
            text-align: left;
            padding-left: 0;
        }

        .team-name {
            width: 100%;
            padding: 10px;
            background: #1a1a2e;
            border: 2px solid #3a3a4e;
            border-radius: 8px;
            color: #e0e0e0;
            font-size: 14px;
            transition: border-color 0.3s;
        }

        .team-name:focus {
            outline: none;
            border-color: #ff6b35;
        }

        .quarter-input {
            width: 60px;
            padding: 10px 5px;
            background: #1a1a2e;
            border: 2px solid #3a3a4e;
            border-radius: 8px;
            color: #e0e0e0;
            font-size: 16px;
            text-align: center;
            transition: all 0.3s;
        }

        .quarter-input:focus {
            outline: none;
            border-color: #ff6b35;
        }

        .quarter-input.higher {
            border-color: #4ecca3;
            background: rgba(78, 204, 163, 0.1);
        }

        .quarter-input.lower {
            border-color: #ee6c4d;
            background: rgba(238, 108, 77, 0.1);
        }

        .prediction-cell {
            font-weight: 600;
            font-size: 14px;
        }

        .prediction-value {
            display: block;
            color: #ff6b35;
            font-size: 18px;
            margin-bottom: 5px;
        }

        .confidence {
            display: inline-block;
            padding: 3px 8px;
            background: #4ecca3;
            color: #1a1a2e;
            border-radius: 10px;
            font-size: 11px;
            font-weight: 700;
        }

        .unsafe {
            background: #ee6c4d;
        }

        .button-container {
            display: flex;
            gap: 10px;
            margin-top: 20px;
        }

        .predict-btn {
            flex: 1;
            padding: 15px;
            background: linear-gradient(135deg, #ff6b35 0%, #f7931e 100%);
            border: none;
            border-radius: 12px;
            color: #1a1a2e;
            font-size: 16px;
            font-weight: 700;
            cursor: pointer;
            transition: transform 0.2s;
            text-transform: uppercase;
            letter-spacing: 1px;
        }

        .predict-btn:active {
            transform: scale(0.98);
        }

        .reset-btn {
            flex: 0 0 auto;
            padding: 15px 25px;
            background: #2a2a3e;
            border: none;
            border-radius: 12px;
            color: #e0e0e0;
            font-size: 16px;
            font-weight: 700;
            cursor: pointer;
            transition: all 0.2s;
            text-transform: uppercase;
            letter-spacing: 1px;
        }

        .reset-btn:hover {
            background: #3a3a4e;
        }

        .reset-btn:active {
            transform: scale(0.98);
        }

        .save-btn {
            width: 100%;
            padding: 12px;
            margin-top: 15px;
            background: #4ecca3;
            border: none;
            border-radius: 8px;
            color: #1a1a2e;
            font-size: 14px;
            font-weight: 600;
            cursor: pointer;
            transition: transform 0.2s;
        }

        .save-btn:active {
            transform: scale(0.98);
        }

        .saved-games {
            display: flex;
            flex-direction: column;
            gap: 15px;
        }

        .game-card {
            background: #2a2a3e;
            border-radius: 12px;
            padding: 15px;
        }

        .game-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
            padding-bottom: 10px;
            border-bottom: 1px solid #3a3a4e;
        }

        .game-date {
            font-size: 12px;
            color: #a0a0a0;
        }

        .game-details {
            font-size: 13px;
            color: #e0e0e0;
            margin-bottom: 10px;
        }

        .team-result {
            display: flex;
            justify-content: space-between;
            padding: 8px 0;
            border-bottom: 1px solid #3a3a4e;
        }

        .team-result:last-child {
            border-bottom: none;
        }

        .team-scores {
            color: #a0a0a0;
            font-size: 12px;
        }

        .prediction-result {
            color: #ff6b35;
            font-weight: 600;
        }

        .verified {
            padding: 6px 12px;
            border-radius: 6px;
            font-size: 12px;
            font-weight: 600;
            display: inline-block;
            margin-top: 10px;
            cursor: pointer;
            transition: all 0.2s;
        }

        .verified:hover {
            opacity: 0.8;
        }

        .verified.correct {
            background: #4ecca3;
            color: #1a1a2e;
        }

        .verified.incorrect {
            background: #ee6c4d;
            color: #1a1a2e;
        }

        .verified.unverified {
            background: #3a3a4e;
            color: #a0a0a0;
        }

        .no-games {
            text-align: center;
            padding: 40px;
            color: #a0a0a0;
        }

        .delete-btn {
            background: #ee6c4d;
            color: #1a1a2e;
            border: none;
            padding: 6px 12px;
            border-radius: 6px;
            font-size: 12px;
            cursor: pointer;
        }

        @media (max-width: 600px) {
            .quarter-input {
                width: 50px;
                padding: 8px 3px;
                font-size: 14px;
            }

            th, td {
                padding: 10px 5px;
                font-size: 11px;
            }

            .team-name {
                font-size: 13px;
                padding: 8px;
            }

            .prediction-value {
                font-size: 16px;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>üèÄ Q4 Predictor</h1>

        <div class="view-toggle">
            <button id="predictBtn" class="active">Predict</button>
            <button id="historyBtn">History</button>
        </div>

        <div id="predictPage" class="page active">
            <div class="game-table">
                <table>
                    <thead>
                        <tr>
                            <th>Team</th>
                            <th>Q1</th>
                            <th>Q2</th>
                            <th>Q3</th>
                            <th>Total Prediction</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr>
                            <td class="team-name-cell">
                                <input type="text" class="team-name" id="team1Name" placeholder="Team 1">
                            </td>
                            <td>
                                <input type="number" class="quarter-input" id="team1Q1" min="0" data-team="1" data-quarter="1">
                            </td>
                            <td>
                                <input type="number" class="quarter-input" id="team1Q2" min="0" data-team="1" data-quarter="2">
                            </td>
                            <td>
                                <input type="number" class="quarter-input" id="team1Q3" min="0" data-team="1" data-quarter="3">
                            </td>
                            <td class="prediction-cell" id="team1Total">
                                <span class="prediction-value">-</span>
                            </td>
                        </tr>
                        <tr>
                            <td class="team-name-cell">
                                <input type="text" class="team-name" id="team2Name" placeholder="Team 2">
                            </td>
                            <td>
                                <input type="number" class="quarter-input" id="team2Q1" min="0" data-team="2" data-quarter="1">
                            </td>
                            <td>
                                <input type="number" class="quarter-input" id="team2Q2" min="0" data-team="2" data-quarter="2">
                            </td>
                            <td>
                                <input type="number" class="quarter-input" id="team2Q3" min="0" data-team="2" data-quarter="3">
                            </td>
                            <td class="prediction-cell" id="team2Total">
                                <span class="prediction-value">-</span>
                            </td>
                        </tr>
                    </tbody>
                </table>
            </div>

            <div class="button-container">
                <button class="predict-btn" onclick="calculatePrediction()">Calculate Prediction</button>
                <button class="reset-btn" onclick="resetPrediction()">Reset</button>
            </div>
            <div id="saveButtonContainer"></div>
        </div>

        <div id="historyPage" class="page">
            <div id="savedGames" class="saved-games"></div>
        </div>
    </div>

    <script>
        let currentPrediction = null;

        function addColorCoding() {
            for (let team = 1; team <= 2; team++) {
                const q1 = parseInt(document.getElementById(`team${team}Q1`).value) || 0;
                const q2 = parseInt(document.getElementById(`team${team}Q2`).value) || 0;
                const q3 = parseInt(document.getElementById(`team${team}Q3`).value) || 0;

                const q2Input = document.getElementById(`team${team}Q2`);
                const q3Input = document.getElementById(`team${team}Q3`);

                q2Input.classList.remove('higher', 'lower');
                q3Input.classList.remove('higher', 'lower');

                if (q2 > q1) q2Input.classList.add('higher');
                else if (q2 < q1) q2Input.classList.add('lower');

                if (q3 > q2) q3Input.classList.add('higher');
                else if (q3 < q2) q3Input.classList.add('lower');
            }
        }

        document.querySelectorAll('input[type="number"]').forEach(input => {
            input.addEventListener('input', addColorCoding);
        });

        function calculateTeamPrediction(q1, q2, q3) {
            let prediction = 'unsafe';
            let confidence = 0;
            let total = 0;

            if (q2 > q1 && q3 < q2) {
                // unsafe
                prediction = 'unsafe';
            } else if (q2 < q1 && q3 > q2) {
                prediction = 'unsafe';
                // prediction = 'UNDER';
                // total = q1 + q2 + q3 + q3 + 1.5;
                // confidence = 66;
            } else if (q2 > q1 && q3 > q2) {
                // let a = 0;
                // if (q3 <= 25) {
                //     prediction = 'OVER';
                //     a = -1.5;
                // } else {
                //     prediction = 'UNDER';
                //     a = 1.5;
                // }
                prediction = 'UNDER';
                total = q1 + q2 + q3 + q3 - 0.5;
                // total = q1 + q2 + q3 + Math.ceil((q1 + q2 + q3)/3) + 1.5
                confidence = 76;
            } else if (q2 < q1 && q3 < q2) {
                prediction = 'OVER';
                total = q1 + q2 + q3 + q3 + 0.5;
                // total = q1 + q2 + q3 + Math.ceil((q1 + q2 + q3)/3) - 1.5
                confidence = 79;
            } else if (q2 === q1 && q3 > q2) {
                // prediction = 'UNDER';
                // total = q1 + q2 + q3 + q3 + 1.5;
                // confidence = 90;
                prediction = 'unsafe';
            } else if (q2 > q1 && q3 === q2) {
                // prediction = 'UNDER';
                // total = q1 + q2 + q3 + q3 + 1.5;
                // confidence = 90;
                prediction = 'unsafe';
            }

            return { prediction, confidence, total };
        }

        function calculatePrediction() {
            const team1Q1 = parseInt(document.getElementById('team1Q1').value) || 0;
            const team1Q2 = parseInt(document.getElementById('team1Q2').value) || 0;
            const team1Q3 = parseInt(document.getElementById('team1Q3').value) || 0;
            const team2Q1 = parseInt(document.getElementById('team2Q1').value) || 0;
            const team2Q2 = parseInt(document.getElementById('team2Q2').value) || 0;
            const team2Q3 = parseInt(document.getElementById('team2Q3').value) || 0;

            const team1Result = calculateTeamPrediction(team1Q1, team1Q2, team1Q3);
            const team2Result = calculateTeamPrediction(team2Q1, team2Q2, team2Q3);

            // Display Team 1 prediction
            const team1TotalCell = document.getElementById('team1Total');

            if (team1Result.prediction === 'unsafe') {
                team1TotalCell.innerHTML = '<span class="confidence unsafe">UNSAFE</span>';
            } else {
                team1TotalCell.innerHTML = `
                    <span class="prediction-value">${team1Result.prediction}<br>${team1Result.total}</span>
                    <span class="confidence">${team1Result.confidence}%</span>
                `;
            }

            // Display Team 2 prediction
            const team2TotalCell = document.getElementById('team2Total');

            if (team2Result.prediction === 'unsafe') {
                team2TotalCell.innerHTML = '<span class="confidence unsafe">UNSAFE</span>';
            } else {
                team2TotalCell.innerHTML = `
                    <span class="prediction-value">${team2Result.prediction}<br>${team2Result.total}</span>
                    <span class="confidence">${team2Result.confidence}%</span>
                `;
            }

            currentPrediction = {
                team1: document.getElementById('team1Name').value || 'Team 1',
                team2: document.getElementById('team2Name').value || 'Team 2',
                team1Scores: [team1Q1, team1Q2, team1Q3],
                team2Scores: [team2Q1, team2Q2, team2Q3],
                timestamp: new Date().toISOString()
            };

            // Show save button if at least one prediction is valid
            if (team1Result.prediction !== 'unsafe' || team2Result.prediction !== 'unsafe') {
                document.getElementById('saveButtonContainer').innerHTML = 
                    '<button class="save-btn" onclick="saveGame()">üíæ Save Game</button>';
            }
        }

        function resetPrediction() {
            // Clear all inputs
            document.getElementById('team1Name').value = '';
            document.getElementById('team2Name').value = '';
            document.getElementById('team1Q1').value = '';
            document.getElementById('team1Q2').value = '';
            document.getElementById('team1Q3').value = '';
            document.getElementById('team2Q1').value = '';
            document.getElementById('team2Q2').value = '';
            document.getElementById('team2Q3').value = '';

            // Clear color coding
            document.querySelectorAll('.quarter-input').forEach(input => {
                input.classList.remove('higher', 'lower');
            });

            // Clear predictions
            document.getElementById('team1Total').innerHTML = '<span class="prediction-value">-</span>';
            document.getElementById('team2Total').innerHTML = '<span class="prediction-value">-</span>';

            // Clear save button
            document.getElementById('saveButtonContainer').innerHTML = '';
            
            currentPrediction = null;
        }

        function saveGame() {
            if (!currentPrediction) return;

            const games = JSON.parse(localStorage.getItem('basketballGames') || '[]');
            games.unshift({ ...currentPrediction, verified: { team1: null, team2: null } });
            localStorage.setItem('basketballGames', JSON.stringify(games));

            alert('Game saved successfully!');
            loadHistory();
        }

        function loadHistory() {
            const games = JSON.parse(localStorage.getItem('basketballGames') || '[]');
            const container = document.getElementById('savedGames');

            if (games.length === 0) {
                container.innerHTML = '<div class="no-games">No saved games yet</div>';
                return;
            }

            container.innerHTML = games.map((game, index) => {
                const team1Result = calculateTeamPrediction(game.team1Scores[0], game.team1Scores[1], game.team1Scores[2]);
                const team2Result = calculateTeamPrediction(game.team2Scores[0], game.team2Scores[1], game.team2Scores[2]);

                return `
                <div class="game-card">
                    <div class="game-header">
                        <div class="game-date">${new Date(game.timestamp).toLocaleString()}</div>
                        <button class="delete-btn" onclick="deleteGame(${index})">Delete</button>
                    </div>
                    <div class="game-details">
                        <div class="team-result">
                            <div>
                                <strong>${game.team1}</strong><br>
                                <span class="team-scores">Q1: ${game.team1Scores[0]} | Q2: ${game.team1Scores[1]} | Q3: ${game.team1Scores[2]}</span>
                            </div>
                            <div style="text-align: right;">
                                ${team1Result.prediction !== 'unsafe' ? `
                                    <span class="prediction-result">${team1Result.prediction} ${team1Result.total}</span><br>
                                    <span class="team-scores">${team1Result.confidence}%</span>
                                ` : '<span class="confidence unsafe">UNSAFE</span>'}
                            </div>
                        </div>
                        ${team1Result.prediction !== 'unsafe' ? `
                            <span class="verified ${game.verified.team1 === null ? 'unverified' : (game.verified.team1 ? 'correct' : 'incorrect')}" 
                                  onclick="toggleVerification(${index}, 'team1')">
                                ${game.verified.team1 === null ? '? Not Verified' : (game.verified.team1 ? '‚úì Correct' : '‚úó Incorrect')}
                            </span>
                        ` : ''}
                        
                        <div class="team-result" style="margin-top: 15px;">
                            <div>
                                <strong>${game.team2}</strong><br>
                                <span class="team-scores">Q1: ${game.team2Scores[0]} | Q2: ${game.team2Scores[1]} | Q3: ${game.team2Scores[2]}</span>
                            </div>
                            <div style="text-align: right;">
                                ${team2Result.prediction !== 'unsafe' ? `
                                    <span class="prediction-result">${team2Result.prediction} ${team2Result.total}</span><br>
                                    <span class="team-scores">${team2Result.confidence}%</span>
                                ` : '<span class="confidence unsafe">UNSAFE</span>'}
                            </div>
                        </div>
                        ${team2Result.prediction !== 'unsafe' ? `
                            <span class="verified ${game.verified.team2 === null ? 'unverified' : (game.verified.team2 ? 'correct' : 'incorrect')}" 
                                  onclick="toggleVerification(${index}, 'team2')">
                                ${game.verified.team2 === null ? '? Not Verified' : (game.verified.team2 ? '‚úì Correct' : '‚úó Incorrect')}
                            </span>
                        ` : ''}
                    </div>
                </div>
            `}).join('');
        }

        function toggleVerification(index, team) {
            const games = JSON.parse(localStorage.getItem('basketballGames') || '[]');
            const current = games[index].verified[team];
            
            // Cycle through: null -> true -> false -> null
            if (current === null) {
                games[index].verified[team] = true;
            } else if (current === true) {
                games[index].verified[team] = false;
            } else {
                games[index].verified[team] = null;
            }
            
            localStorage.setItem('basketballGames', JSON.stringify(games));
            loadHistory();
        }

        function deleteGame(index) {
            const games = JSON.parse(localStorage.getItem('basketballGames') || '[]');
            games.splice(index, 1);
            localStorage.setItem('basketballGames', JSON.stringify(games));
            loadHistory();
        }

        document.getElementById('predictBtn').addEventListener('click', function() {
            document.getElementById('predictPage').classList.add('active');
            document.getElementById('historyPage').classList.remove('active');
            this.classList.add('active');
            document.getElementById('historyBtn').classList.remove('active');
        });

        document.getElementById('historyBtn').addEventListener('click', function() {
            document.getElementById('historyPage').classList.add('active');
            document.getElementById('predictPage').classList.remove('active');
            this.classList.add('active');
            document.getElementById('predictBtn').classList.remove('active');
            loadHistory();
        });

        loadHistory();
    </script>
</body>
</html>
